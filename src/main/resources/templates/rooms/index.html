<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Rooms Management</title>
</head>
<body>
<h1>Rooms Management
    <span th:if="${hospital}" th:text="' - ' + ${hospital.name}"></span>
</h1>

<a th:href="@{/rooms/new(hospitalId=${hospital?.id})}" class="btn">Create New Room</a>
<a th:href="@{/rooms}" class="btn">All Rooms</a>

<!-- Hospital Filter -->
<form method="get" action="/rooms">
    <select name="hospitalId" onchange="this.form.submit()">
        <option value="">All Hospitals</option>
        <option th:each="h : ${hospitals}"
                th:value="${h.id}"
                th:text="${h.name}"
                th:selected="${hospital?.id == h.id}">
        </option>
    </select>
</form>

<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>Room Number</th>
        <th>Type</th>
        <th>Capacity</th>
        <th>Available</th>
        <th>Hospital</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="room : ${rooms}">
        <td th:text="${room.id}"></td>
        <td th:text="${room.roomNumber}"></td>
        <td th:text="${room.type}"></td>
        <td th:text="${room.capacity}"></td>
        <td>
            <span th:if="${room.available}" style="color: green">✓ Available</span>
            <span th:if="${!room.available}" style="color: red">✗ Occupied</span>
        </td>
        <td th:text="${room.hospital.name}"></td>
        <td>
            <a th:href="@{/rooms/{id}(id=${room.id})}">View</a>
            <a th:href="@{/rooms/edit/{id}(id=${room.id})}">Edit</a>
            <form th:action="@{/rooms/{id}/delete(id=${room.id}, hospitalId=${hospital?.id})}"
                  method="post" style="display: inline;">
                <button type="submit" onclick="return confirm('Delete this room?')">Delete</button>
            </form>
            <span th:if="${room.available}">
                        <form th:action="@{/rooms/{id}/occupy(id=${room.id}, hospitalId=${hospital?.id})}"
                              method="post" style="display: inline;">
                            <button type="submit">Occupy</button>
                        </form>
                    </span>
            <span th:if="${!room.available}">
                        <form th:action="@{/rooms/{id}/vacate(id=${room.id}, hospitalId=${hospital?.id})}"
                              method="post" style="display: inline;">
                            <button type="submit">Vacate</button>
                        </form>
                    </span>
        </td>
    </tr>
    </tbody>
</table>
</body>
</html>