<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Patient Management</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .sort-link { text-decoration: none; color: inherit; font-weight: bold; }
        .sort-link:hover { text-decoration: underline; }
    </style>
</head>
<body class="container mt-4">

<h1>Patient Management</h1>

<div class="card card-body mb-4 shadow-sm">
    <form th:action="@{/patients}" method="get" class="row g-3">
        <div class="col-md-4">
            <input type="text" name="name" th:value="${name}" class="form-control" placeholder="Filter by Name">
        </div>
        <div class="col-md-4">
            <input type="text" name="email" th:value="${email}" class="form-control" placeholder="Filter by Email">
        </div>
        <div class="col-md-4 d-flex gap-2">
            <button type="submit" class="btn btn-primary">Apply Filters</button>
            <a th:href="@{/patients}" class="btn btn-outline-secondary">Reset</a>
        </div>
        <input type="hidden" name="sortField" th:value="${sortField}">
        <input type="hidden" name="sortDir" th:value="${sortDir}">
    </form>
</div>

<table class="table table-striped table-hover table-bordered shadow-sm">
    <thead class="table-dark">
    <tr>
        <th>
            <a class="text-white sort-link" th:href="@{/patients(name=${name}, email=${email}, sortField='name', sortDir=${reverseSortDir})}">
                Name <span th:text="${sortField == 'name' ? (sortDir == 'asc' ? '↑' : '↓') : ''}"></span>
            </a>
        </th>
        <th>
            <a class="text-white sort-link" th:href="@{/patients(name=${name}, email=${email}, sortField='email', sortDir=${reverseSortDir})}">
                Email <span th:text="${sortField == 'email' ? (sortDir == 'asc' ? '↑' : '↓') : ''}"></span>
            </a>
        </th>
        <th>Date of Birth</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="p : ${patients}">
        <td th:text="${p.name}"></td>
        <td th:text="${p.email}"></td>
        <td th:text="${#temporals.format(p.dateOfBirth, 'dd.MM.yyyy')}"></td>
        <td>
            <div class="btn-group">
                <a th:href="@{/patients/{id}(id=${p.id})}" class="btn btn-sm btn-info">Details</a>
                <a th:href="@{/patients/edit/{id}(id=${p.id})}" class="btn btn-sm btn-primary">Edit</a>
                <form th:action="@{/patients/{id}/delete(id=${p.id})}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete patient and ALL appointments?')">Delete</button>
                </form>
            </div>
        </td>
    </tr>
    </tbody>
</table>
</body>
</html>