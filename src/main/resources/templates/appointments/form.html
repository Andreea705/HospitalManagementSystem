<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <title th:text="${appointment?.id != null} ? 'Edit Appointment' : 'New Appointment'">-->
<!--        Appointment Form-->
<!--    </title>-->
<!--</head>-->
<!--<body>-->
<!--<h2 th:text="${appointment?.id != null} ? 'Edit Appointment' : 'New Appointment'">-->
<!--    Appointment Form-->
<!--</h2>-->

<!--<form th:object="${appointment}"-->
<!--      th:action="${appointment?.id != null} ?-->
<!--                 @{/appointments/update/{id}(id=${appointment.id})} :-->
<!--                 @{/appointments}"-->
<!--      method="post">-->

<!--    &lt;!&ndash; Pentru editare, adaugă câmp ascuns pentru ID &ndash;&gt;-->
<!--    <input type="hidden" th:field="*{id}" th:if="${appointment?.id != null}" />-->

<!--    &lt;!&ndash; Patient - dropdown în loc de text input &ndash;&gt;-->
<!--    <div>-->
<!--        <label for="patientId">Patient:</label>-->
<!--        <select id="patientId" name="patientId" required>-->
<!--            <option value="">Select Patient</option>-->
<!--            <option th:each="patient : ${patients}"-->
<!--                    th:value="${patient.id}"-->
<!--                    th:text="${patient.name}"-->
<!--                    th:selected="${appointment?.patient?.id == patient.id}">-->
<!--            </option>-->
<!--        </select>-->
<!--    </div>-->

<!--    &lt;!&ndash; Appointment Date &ndash;&gt;-->
<!--    <div>-->
<!--        <label for="appointmentDate">Appointment Date:</label>-->
<!--        <input type="datetime-local" th:field="*{appointmentDate}"-->
<!--               id="appointmentDate"-->
<!--               th:min="${today}"-->
<!--               required />-->
<!--    </div>-->

<!--    &lt;!&ndash; Departament - doar pentru creare &ndash;&gt;-->
<!--    <div th:if="${appointment?.id == null}">-->
<!--        <label for="departmentId">Department:</label>-->
<!--        <select id="departmentId" name="departmentId"-->
<!--                th:onchange="loadDoctors(this.value)"-->
<!--                required>-->
<!--            <option value="">Select Department</option>-->
<!--            <option th:each="dept : ${departments}"-->
<!--                    th:value="${dept.id}"-->
<!--                    th:text="${dept.name}"-->
<!--                    th:selected="${selectedDepartmentId == dept.id}">-->
<!--            </option>-->
<!--        </select>-->
<!--    </div>-->

<!--    &lt;!&ndash; Departament pentru editare (doar afișare) &ndash;&gt;-->
<!--    <div th:if="${appointment?.id != null}">-->
<!--        <label>Department:</label>-->
<!--        <span th:if="${appointment?.department != null}"-->
<!--              th:text="${appointment?.department?.name}">Department Name</span>-->
<!--        <span th:if="${appointment?.department == null}">Not assigned</span>-->
<!--        &lt;!&ndash; Trimite departmentId ca parametru ascuns &ndash;&gt;-->
<!--        <input type="hidden" name="departmentId"-->
<!--               th:value="${appointment?.department?.id}"-->
<!--               th:if="${appointment?.department != null}" />-->
<!--    </div>-->

<!--    &lt;!&ndash; Doctor &ndash;&gt;-->
<!--    <div>-->
<!--        <label for="doctorId">Doctor:</label>-->
<!--        <select id="doctorId" name="doctorId">-->
<!--            <option value="">No doctor assigned</option>-->
<!--            <option th:each="doctor : ${doctors}"-->
<!--                    th:value="${doctor.id}"-->
<!--                    th:text="${doctor.medicalStaffName ?: doctor.firstName + ' ' + doctor.lastName}"-->
<!--                    th:selected="${appointment?.doctor?.id == doctor.id}">-->
<!--            </option>-->
<!--        </select>-->
<!--    </div>-->

<!--    &lt;!&ndash; Status &ndash;&gt;-->
<!--    <div>-->
<!--        <label for="status">Status:</label>-->
<!--        <select th:field="*{status}" id="status" required>-->
<!--            <option value="">Select Status</option>-->
<!--            <option th:each="status : ${statuses}"-->
<!--                    th:value="${status}"-->
<!--                    th:text="${status}"-->
<!--                    th:selected="${appointment?.status == status}">-->
<!--            </option>-->
<!--        </select>-->
<!--    </div>-->

<!--    &lt;!&ndash; Descriere &ndash;&gt;-->
<!--    <div>-->
<!--        <label for="description">Description:</label>-->
<!--        <textarea th:field="*{description}" id="description" rows="3"></textarea>-->
<!--    </div>-->

<!--    &lt;!&ndash; Butoane &ndash;&gt;-->
<!--    <div style="margin-top: 20px;">-->
<!--        <button type="submit" th:text="${appointment?.id != null} ? 'Update' : 'Create'">-->
<!--            Save-->
<!--        </button>-->
<!--        <a th:href="@{/appointments}" style="margin-left: 10px;">Cancel</a>-->
<!--    </div>-->
<!--</form>-->

<!--&lt;!&ndash; JavaScript simplu pentru încărcarea doctorilor &ndash;&gt;-->
<!--<script>-->
<!--    function loadDoctors(departmentId) {-->
<!--        if (departmentId) {-->
<!--            window.location.href = '/appointments/new?departmentId=' + departmentId;-->
<!--        }-->
<!--    }-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${appointment?.id != null} ? 'Edit Appointment' : 'New Appointment'">
        Appointment Form
    </title>
    <script>
        function updatePatientName() {
            const patientSelect = document.getElementById('patientId');
            const patientNameField = document.getElementById('patientNameField');
            const selectedOption = patientSelect.options[patientSelect.selectedIndex];

            if (selectedOption.value && selectedOption.value !== '') {
                patientNameField.value = selectedOption.text;
            }
        }

        function loadDoctors(departmentId) {
            // Actualizează patientName înainte de redirect
            updatePatientName();
            if (departmentId) {
                window.location.href = '/appointments/new?departmentId=' + departmentId;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Actualizează patientName la schimbarea selecției
            const patientSelect = document.getElementById('patientId');
            if (patientSelect) {
                patientSelect.addEventListener('change', updatePatientName);
                // Inițializează la încărcare
                updatePatientName();
            }
        });
    </script>
</head>
<body>
<h2 th:text="${appointment?.id != null} ? 'Edit Appointment' : 'New Appointment'">
    Appointment Form
</h2>

<form th:object="${appointment}"
      th:action="${appointment?.id != null} ?
                 @{/appointments/update/{id}(id=${appointment.id})} :
                 @{/appointments}"
      method="post">

    <input type="hidden" th:field="*{id}" th:if="${appointment?.id != null}" />

    <!-- Câmp ascuns pentru patientName -->
    <input type="hidden" id="patientNameField" name="patientName"
           th:value="${appointment?.patientName ?: appointment?.patient?.name}" />

    <!-- Patient - dropdown -->
    <div>
        <label for="patientId">Patient:</label>
        <select id="patientId" name="patientId" required>
            <option value="">Select Patient</option>
            <option th:each="patient : ${patients}"
                    th:value="${patient.id}"
                    th:text="${patient.name}"
                    th:selected="${appointment?.patient?.id == patient.id}">
            </option>
        </select>
    </div>

    <!-- Restul formularului rămâne la fel... -->
    <div>
        <label for="appointmentDate">Appointment Date:</label>
        <input type="datetime-local" th:field="*{appointmentDate}"
               id="appointmentDate"
               th:min="${today}"
               required />
    </div>

    <div th:if="${appointment?.id == null}">
        <label for="departmentId">Department:</label>
        <select id="departmentId" name="departmentId"
                th:onchange="loadDoctors(this.value)"
                required>
            <option value="">Select Department</option>
            <option th:each="dept : ${departments}"
                    th:value="${dept.id}"
                    th:text="${dept.name}"
                    th:selected="${selectedDepartmentId == dept.id}">
            </option>
        </select>
    </div>

    <div th:if="${appointment?.id != null}">
        <label>Department:</label>
        <span th:if="${appointment?.department != null}"
              th:text="${appointment?.department?.name}">Department Name</span>
        <input type="hidden" name="departmentId"
               th:value="${appointment?.department?.id}"
               th:if="${appointment?.department != null}" />
    </div>

    <div>
        <label for="doctorId">Doctor:</label>
        <select id="doctorId" name="doctorId">
            <option value="">No doctor assigned</option>
            <option th:each="doctor : ${doctors}"
                    th:value="${doctor.id}"
                    th:text="${doctor.medicalStaffName ?: doctor.firstName + ' ' + doctor.lastName}"
                    th:selected="${appointment?.doctor?.id == doctor.id}">
            </option>
        </select>
    </div>

    <div>
        <label for="status">Status:</label>
        <select th:field="*{status}" id="status" required>
            <option value="">Select Status</option>
            <option th:each="status : ${statuses}"
                    th:value="${status}"
                    th:text="${status}"
                    th:selected="${appointment?.status == status}">
            </option>
        </select>
    </div>

    <div>
        <label for="description">Description:</label>
        <textarea th:field="*{description}" id="description" rows="3"></textarea>
    </div>

    <div style="margin-top: 20px;">
        <button type="submit" th:text="${appointment?.id != null} ? 'Update' : 'Create'">
            Save
        </button>
        <a th:href="@{/appointments}" style="margin-left: 10px;">Cancel</a>
    </div>
</form>
</body>
</html>