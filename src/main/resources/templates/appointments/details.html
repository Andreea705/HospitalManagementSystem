<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Appointment Details</title>
</head>
<body>
<h1>Appointment Details</h1>

<div>
    <strong>ID:</strong> <span th:text="${appointment.id}"></span>
</div>
<div>
    <strong>Patient Name:</strong> <span th:text="${appointment.patientName}"></span>
</div>
<div>
    <strong>Appointment Date:</strong> <span th:text="${appointment.appointmentDate}"></span>
</div>
<div>
    <strong>Status:</strong>
    <span th:text="${appointment.status}"
          th:style="${appointment.status == 'ACTIVE'} ? 'color: green;' :
                    (${appointment.status == 'COMPLETED'} ? 'color: blue;' : 'color: orange;')">
    </span>
</div>
<div>
    <strong>Description:</strong> <span th:text="${appointment.description}"></span>
</div>
<div>
    <strong>Department:</strong>
    <a th:href="@{/departments/{id}(id=${appointment.department.id})}" th:if="${appointment.department != null}">
        <span th:text="${appointment.department.name}"></span>
    </a>
    <span th:if="${appointment.department == null}">Not assigned</span>
</div>
<div>
    <strong>Doctor:</strong>
    <a th:href="@{/doctors/{id}(id=${appointment.doctor.id})}" th:if="${appointment.doctor != null}">
        <span th:text="${appointment.doctor.medicalStaffName}"></span>
        (<span th:text="${appointment.doctor.specialization}"></span>)
    </a>
    <span th:if="${appointment.doctor == null}">Not assigned</span>
</div>
<div>
    <strong>Created:</strong> <span th:text="${appointment.createdAt}"></span>
</div>
<div>
    <strong>Last Updated:</strong> <span th:text="${appointment.updatedAt}"></span>
</div>

<div style="margin-top: 20px;">
    <a th:href="@{/appointments/edit/{id}(id=${appointment.id})}" class="btn">Edit</a>
    <a th:href="@{/appointments}" class="btn">Back to List</a>
    <form th:action="@{/appointments/{id}/delete(id=${appointment.id})}"
          method="post" style="display: inline;">
        <button type="submit" onclick="return confirm('Delete this appointment?')">Delete</button>
    </form>

    <!-- Business Actions -->
    <div style="margin-top: 10px;">
        <form th:action="@{/appointments/{id}/complete(id=${appointment.id})}"
              method="post" style="display: inline;">
            <button type="submit" th:if="${appointment.status != 'COMPLETED'}"
                    onclick="return confirm('Mark as completed?')">Mark as Completed</button>
        </form>

        <form th:action="@{/appointments/{id}/assign-doctor(id=${appointment.id})}"
              method="post" style="display: inline;">
            <select name="doctorId">
                <option value="">Select Doctor</option>
                <option th:each="doc : ${doctors}"
                        th:value="${doc.id}"
                        th:text="${doc.medicalStaffName} + ' - ' + ${doc.specialization}">
                </option>
            </select>
            <button type="submit">Assign Doctor</button>
        </form>

        <form th:action="@{/appointments/{id}/remove-doctor(id=${appointment.id})}"
              method="post" style="display: inline;">
            <button type="submit" th:if="${appointment.doctor != null}"
                    onclick="return confirm('Remove doctor from appointment?')">Remove Doctor</button>
        </form>
    </div>
</div>
</body>
</html>